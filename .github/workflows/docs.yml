# SPDX-FileCopyrightText: 2024 The Forkbomb Company
#
# SPDX-License-Identifier: AGPL-3.0-or-later

name: ğŸ“– Docs

on:
  push:
    branches:
      - main
    paths: [ "docs/**" ]

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: pages
  cancel-in-progress: false

jobs:
  packageManager:
    name: ğŸ” Get pnpm version to use
    runs-on: ubuntu-latest
    outputs:
      version: ${{ steps.ver.outputs.version }}
    steps:
      - name: ğŸ›ï¸ Checkout
        uses: actions/checkout@v4
      - name: ğŸ” Get pnpm version from pacakgeManager field
        id: ver
        run: |
          echo "version=$( jq -r '.packageManager' package.json | cut -d@ -f2 )" >> $GITHUB_OUTPUT

  build_docs:
    name: ğŸ—ï¸ Build documentation
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    steps:
      - name: ğŸ› ï¸ Prepare pnpm workspace
        uses: dyne/pnpm@main
        with:
          node-version: 20
          pnpm-version: ${{ needs.packageManager.outputs.version }}
      - name: ğŸ“– Setup Pages
        uses: actions/configure-pages@v5
      - name: ğŸ—ï¸ update sentences tabled and build the docs
        run: pnpm run docs:build
      - name: â« Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: docs/.vitepress/dist

  deploy_docs:
    name: ğŸš€ Deploy documentation
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    needs: build_docs
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¡ Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
